<div class="row">
        <div class="col-md-8 col-sm-12">
            <div class="card">
                <div class="card-header card-header-icon" data-background-color="purple">
                    <i class="material-icons">public</i>
                </div>
                <div class="card-content">
                    <h4 class="card-title">Classement des entreprises embauchant le plus d'étudiants</h4>
                    <div class="material-datatables">
                        <table id="businessDatatables" class="table table-striped table-no-bordered table-hover" cellspacing="0" width="100%" style="width:100%">
                            <thead>
                            <tr>
                                <th>#</th>
                                <th class="disabled-sorting">Nom</th>
                                <th class="disabled-sorting">Nombre d'étudiants</th>
                                <th class="disabled-sorting">Téléphone</th>
                                <th class="disabled-sorting">Date de création</th>
                                <th class="disabled-sorting text-right">Actions</th>
                            </tr>
                            </thead>
                            <tfoot>
                            <tr>
                                <th>#</th>
                                <th>Nom</th>
                                <th>Nombre d'étudiants</th>
                                <th>Téléphone</th>
                                <th>Date de création</th>
                                <th class="text-right">Actions</th>
                            </tr>
                            </tfoot>
                            <tbody>
                            <? foreach($var->tabEntreprises as $key=>$content) { ?>
                            <tr>
                                <td><?= $key+1 ?></td>
                                <td><?= $this->_setLink($content->name,['nav'=>'business','part'=>'view','id'=> \lib\Crypt::encrypt($content->ID)])?></td>
                                <td><?= $content->countStudent?></td>
                                <td><?= $this->_setLink(str_replace(' ','',$content->phone),'callto',['title' => 'Appelez moi !']) ?></td>
                                <td><?= $content->creation_date->format('dd/mm/yyyy'); ?></td>
                                <td class="text-right" data-id="<?= \lib\Crypt::encrypt($content->ID) ?>">
                                    <a href="#" class="btn btn-simple <? if($content->partner) echo 'btn-primary'; else echo 'btn-muted'; ?> btn-icon partner" data-toggle="tooltip" title="Assigner comme partenaire"><i class="material-icons">favorite</i></a>
                                    <?= $this->_setLink('<i class="material-icons">dvr</i>',['nav'=>'business','part'=>'view','id'=> \lib\Crypt::encrypt($content->ID)],['class'=>'btn btn-simple btn-info btn-icon view', 'data-toggle'=>'tooltip','title'=>'Plus d&apos;informations']);?>
                                </td>
                            </tr>
                            <? } ?>
                            </tbody>
                        </table>
                    </div>
                </div>
                <!-- end content-->
            </div>
        </div>
        <div class="col-md-4 col-sm-12">
            <div class="col-md-12 col-sm-6">
                <div class="card card-stats">
                    <div class="card-header" data-background-color="rose">
                        <i class="material-icons">group</i>
                    </div>
                    <div class="card-content">
                        <p class="category">Nombre de stagiaires</p>
                        <h3 class="card-title"><?= $var->cardsData->nbTrainee; ?></h3>
                    </div>
                    <div class="card-footer">
                        <div class="stats">
                            <i class="material-icons">info</i> Sur une liste de <?= $var->cardsData->nbStudents; ?> étudiants
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-12 col-sm-6">
                <div class="card card-stats">
                    <div class="card-header" data-background-color="orange">
                        <i class="material-icons">list</i>
                    </div>
                    <div class="card-content">
                        <p class="category">Nombre de stages proposés</p>
                        <h3 class="card-title"><?= $var->cardsData->nbPropositions; ?></h3>
                    </div>
                    <div class="card-footer">
                        <div class="stats">
                            <i class="material-icons">info</i> Nombre de propositions trouvé depuis vos <?= $var->cardsData->nbBusiness; ?> entrerpises
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-12 col-sm-6">
                <div class="card card-stats">
                    <div class="card-header" data-background-color="green">
                        <i class="material-icons">business</i>
                    </div>
                    <div class="card-content">
                        <p class="category">Nombre d'entreprise</p>
                        <h3 class="card-title"><?= $var->cardsData->nbBusiness; ?></h3>
                    </div>
                    <div class="card-footer">
                        <div class="stats">
                            <i class="material-icons">info</i> Dont <span class="nbPartner"><?= $var->cardsData->nbPartner ?></span> entreprises partenaires
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-12 col-sm-6">
                <div class="card card-stats">
                    <div class="card-header" data-background-color="blue">
                        <i class="material-icons">equalizer</i>
                    </div>
                    <div class="card-content">
                        <p class="category">Pourcentage de stage trouvés</p>
                        <h3 class="card-title"><?= $var->cardsData->percentOfFindJob; ?></h3>
                    </div>
                    <div class="card-footer">
                        <div class="stats">
                            <i class="material-icons">info</i> Sur une liste de <?= $var->cardsData->nbStudents; ?> étudiants
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header card-header-icon" data-background-color="blue">
                    <i class="material-icons">timeline</i>
                </div>
                <div class="card-content">
                    <h4 class="card-title">Evolution du nombre de stagiaires
                        <small> - Resultats annuel</small>
                    </h4>
                </div>
                <div id="colouredRoundedLineChart" class="ct-chart"></div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header card-header-icon" data-background-color="rose">
                    <i class="material-icons">group</i>
                </div>
                <div class="card-content">
                    <h4 class="card-title">Liste des étudiants sans stage</h4>
                    <div class="material-datatables">
                        <table id="studentDatatable" class="table table-striped table-no-bordered table-hover" cellspacing="0" width="100%" style="width:100%">
                            <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nom</th>
                                <th>Groupe</th>
                                <th class="disabled-sorting">Mail</th>
                                <th class="disabled-sorting text-right">Actions</th>
                            </tr>
                            </thead>
                            <tfoot>
                            <tr>
                                <th>ID</th>
                                <th>Nom</th>
                                <th>Groupe</th>
                                <th>Mail</th>
                                <th class="text-right">Actions</th>
                            </tr>
                            </tfoot>
                            <tbody>
                            <? foreach($var->tabStudents as $key=>$content) { ?>
                            <tr>
                                <td><?= $content->ID ?></td>
                                <td><?= $this->_setLink($content->fname.' '.$content->name,['nav'=>'students','part'=>'view','id'=> \lib\Crypt::encrypt($content->ID)])?></td>
                                <td><?= $content->group?></td>
                                <td><?= $this->_setLink(str_replace(' ','',$content->email),'mailto',['title' => 'Ecrivez-moi !']) ?></td>
                                <td class="text-right" data-id="<?= \lib\Crypt::encrypt($content->ID) ?>">
                                    <?= $this->_setLink('<i class="material-icons">dvr</i>',['nav'=>'students','part'=>'view','id'=> \lib\Crypt::encrypt($content->ID)],['class'=>'btn btn-simple btn-info btn-icon view', 'data-toggle'=>'tooltip','title'=>'Plus d&apos;informations']);?>
                                    <?= $this->_setLink('<i class="material-icons">settings</i>',['nav'=>'students','part'=>'edit','id'=> \lib\Crypt::encrypt($content->ID)],['class'=>'btn btn-simple btn-warning btn-icon edit', 'data-toggle'=>'tooltip','title'=>'Modifier les informations']);?>
                                </td>
                            </tr>
                            <? } ?>
                            </tbody>
                        </table>
                    </div>
                </div>
                <!-- end content-->
            </div>
        </div>
    </div>
<script type="text/javascript">
    $(document).ready(function() {

        $('[data-toggle="tooltip"]').tooltip();

        $('#businessDatatables,#studentDatatable').DataTable({
            "pagingType": "full_numbers",
            "lengthMenu": [
                [10, 25, 50, -1],
                [10, 25, 50, "All"]
            ],
            responsive: true,
            language: {
                search: "_INPUT_",
                searchPlaceholder: "Rechercher",
                lengthMenu : "Afficher _MENU_ lignes",
                info : "Affichage de la page _PAGE_ sur _PAGES_",
                previous : "Précédent",
                paginate : {
                    first : "Début",
                    previous : "Précédent",
                    next : "Suivant",
                    last : "Fin"
                }
            }

        });


        var table = $('#businessDatatables').DataTable();
        var table2 = $('#studentDatatable').DataTable();

        //Assign Partner status to record
        table.on('click', '.partner', function() {
            var $this = $(this);
            var id = $this.parent().data('id');
            if($this.hasClass('btn-muted')){
                $.get('index.php?admin=true&nav=business&part=ajax_add_partner&id='+id)
                        .done(function(data){
                            if(data == 'true'){
                                var nbPartner = parseInt($('.nbPartner').text());
                                $('.nbPartner').text(nbPartner+1);
                                $this.removeClass('btn-muted').addClass('btn-primary');
                            }
                            else
                                showErrorEdit();
                        })
                        .fail(showErrorEdit)
            }else{
                $.get('index.php?admin=true&nav=business&part=ajax_remove_partner&id='+id)
                        .done(function(data){
                            if(data == 'true'){
                                var nbPartner = parseInt($('.nbPartner').text());
                                $('.nbPartner').text(nbPartner-1);
                                $this.removeClass('btn-primary').addClass('btn-muted');
                            }
                            else
                                showErrorEdit();
                        })
                        .fail(showErrorEdit)
            }
        });

        function showErrorEdit(){ swal('Erreur','Erreur lors de la modification','error') }

        $('.card .material-datatables label').addClass('form-group');


        /**
         *  Charts
         */


        dataColouredRoundedLineChart = {
            labels: [<?= implode(",",$var->monthList) ?>],
            series: [
                [<?= implode(",",$var->dataChart)?>]
            ]
        };

        optionsColouredRoundedLineChart = {
            lineSmooth: Chartist.Interpolation.cardinal({
                tension: 10
            }),
            axisY: {
                showGrid: true,
                offset: 40
            },
            axisX: {
                showGrid: false,
            },
            low: <?= $var->dataChart[0] ?>,
            high: <?= $var->dataChart[count($var->dataChart)-1] ?>,
            showPoint: true,
            height: '300px'
        };


        var colouredRoundedLineChart = new Chartist.Line('#colouredRoundedLineChart', dataColouredRoundedLineChart, optionsColouredRoundedLineChart);

        md.startAnimationForLineChart(colouredRoundedLineChart);
    });
</script>