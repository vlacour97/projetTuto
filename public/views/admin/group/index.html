<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header card-header-icon" data-background-color="purple">
                    <i class="material-icons">business</i>
                </div>
                <div class="card-content">
                    <h4 class="card-title"><?= $var->titlePage; ?></h4>
                    <div class="toolbar text-right">
                        <a href="#" class="btn btn-primary btn-round btn-fab btn-fab-mini add" data-toggle="tooltip" title="Ajouter un groupe"><i class="material-icons">add</i></a>
                    </div>
                    <div class="material-datatables">
                        <table id="datatables" class="table table-striped table-no-bordered table-hover" cellspacing="0" width="100%" style="width:100%">
                            <thead>
                            <tr>
                                <th>ID</th>
                                <th class="disabled-sorting">Libelé</th>
                                <th class="disabled-sorting text-right">Actions</th>
                            </tr>
                            </thead>
                            <tfoot>
                            <tr>
                                <th>ID</th>
                                <th>Libelé</th>
                                <th class="text-right">Actions</th>
                            </tr>
                            </tfoot>
                            <tbody>
                            <? foreach($var->tabGroup as $key=>$content) {?>
                            <tr>
                                <td><?= $key+1 ?></td>
                                <td class="lbl"><?= $content->label ?></td>
                                <td class="text-right" data-id="<?= \lib\Crypt::encrypt($content->ID) ?>">
                                    <a href="#" class="btn btn-simple btn-primary btn-icon edit" data-toggle="tooltip" title="Modifier"><i class="material-icons">settings</i></a>
                                    <a href="#" class="btn btn-simple btn-danger btn-icon remove" data-toggle="tooltip" title="Supprimer"><i class="material-icons">close</i></a>
                                </td>
                            </tr>
                            <? } ?>
                            </tbody>
                        </table>
                    </div>
                </div>
                <!-- end content-->
            </div>
            <!--  end card  -->
        </div>
        <!-- end col-md-12 -->
    </div>
    <!-- end row -->
</div>

<script type="text/javascript">
    $(document).ready(function() {

        $('[data-toggle="tooltip"]').tooltip();

        $('#datatables').DataTable({
            "pagingType": "full_numbers",
            "lengthMenu": [
                [10, 25, 50, -1],
                [10, 25, 50, "All"]
            ],
            responsive: true,
            language: {
                search: "_INPUT_",
                searchPlaceholder: "Rechercher",
                lengthMenu : "Afficher _MENU_ lignes",
                info : "Affichage de la page _PAGE_ sur _PAGES_",
                previous : "Précédent",
                paginate : {
                    first : "Début",
                    previous : "Précédent",
                    next : "Suivant",
                    last : "Fin"
                }
            }

        });


        var table = $('#datatables').DataTable();

        $('.add').on('click',function(){
            swal({
                title: 'Ajout d\'un nouveau groupe',
                html: '<div class="form-group">' +
                '<input id="input-field" type="text" placeholder="Nom du groupe" class="form-control" />' +
                '</div>',
                showCancelButton: true,
                confirmButtonClass: 'btn btn-success',
                cancelButtonClass: 'btn btn-danger',
                buttonsStyling: false
            }).then(function(result) {
                var value = $('#input-field').val();
                $.get('index.php?admin=true&nav=group&part=ajax_add_group&name='+value)
                        .done(function (data) {
                            if(data == "true"){
                                table.row.add([(table.data().count()/3)+1,value,'<div class="text-right"><a href="#" class="btn btn-simple btn-primary btn-icon" disabled data-toggle="tooltip" title="Modifier"><i class="material-icons">settings</i></a> <a href="#" class="btn btn-simple btn-danger btn-icon" disabled data-toggle="tooltip" title="Supprimer"><i class="material-icons">close</i></a></div>']).draw();
                                swal({
                                    type: 'success',
                                    html: 'Le groupe <strong>' +
                                    value +
                                    '</strong> a bien été ajouté !',
                                    confirmButtonClass: 'btn btn-success',
                                    buttonsStyling: false

                                })
                            }else
                                showErrorAdd();
                        })
                        .fail(showErrorAdd())

            }).catch(swal.noop)
        });

        //Assign Partner status to record
        table.on('click', '.edit', function() {
            $this = $(this);
            $tr = $(this).closest('tr');
            var data = table.row($tr).data();
            var id = $(this).parent().data('id');
            swal({
                title: 'Ajout d\'un nouveau groupe',
                html: '<div class="form-group">' +
                '<input id="input-field" type="text" placeholder="Nom du groupe" value="' + data[1] + '" class="form-control" />' +
                '</div>',
                showCancelButton: true,
                confirmButtonClass: 'btn btn-success',
                cancelButtonClass: 'btn btn-danger',
                buttonsStyling: false
            }).then(function(result) {
                var value = $('#input-field').val();
                $.get('index.php?admin=true&nav=group&part=ajax_edit_group&id='+id+'&name='+value)
                        .done(function (data) {
                            if(data == "true"){
                                $this.parent().parent().find('.lbl').html(value);
                                console.log($this.parent().parent().find('.lbl'));
                                swal({
                                    type: 'success',
                                    html: 'Le groupe <strong>' +
                                    value +
                                    '</strong> a bien été ajouté !',
                                    confirmButtonClass: 'btn btn-success',
                                    buttonsStyling: false

                                })
                            }else
                                showErrorEdit();
                        })
                        .fail(showErrorEdit())

            }).catch(swal.noop)
        });

        // Delete a record
        table.on('click', '.remove', function(e) {
            var $this = $(this);
            var id = $this.parent().data('id');
            $tr = $(this).closest('tr');
            $.get('index.php?admin=true&nav=group&part=ajax_remove_group&id='+id)
                    .done(function(data){
                        if(data == 'true'){
                            table.row($tr).remove().draw();
                            e.preventDefault();
                        }
                        else
                            showErrorDelete();
                    })
                    .fail(showErrorDelete)
        });

        function showErrorAdd(){ swal('Erreur','Une erreur est survenu lors de l\'ajout de votre groupe','error') }

        function showErrorEdit(){ swal('Erreur','Erreur lors de la modification de votre groupe','error') }

        function showErrorDelete(){ swal('Erreur','Erreur lors de la suppression de votre groupe','error') }

        $('.card .material-datatables label').addClass('form-group');
    });
</script>